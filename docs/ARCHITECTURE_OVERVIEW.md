# Архитектура системы - Общий обзор

## Введение

Данный документ описывает целостную архитектуру дропшиппинг‑системы, ориентированной на мультиплатформенную торговлю (eBay, Shopify, Meta, AutoDS) с использованием оркестрации через n8n, централизованного хранилища данных в Supabase и набора AI‑инструментов.

## Архитектурные принципы

1. **Модульность**: Система состоит из независимых модулей, которые могут развиваться отдельно
2. **Масштабируемость**: Архитектура позволяет постепенно наращивать функциональность
3. **Надёжность**: Множественные источники данных и резервирование критичных компонентов
4. **Безопасность**: Централизованное управление секретами и строгий контроль доступа
5. **Документированность**: Все решения фиксируются в базе знаний

## Компоненты системы

### 1. Платформы продаж

#### eBay
- **eBay.com**: Фронт продаж для рынка США
- **eBay.de**: Источник закупок и локальный аккаунт для EU‑контекста
- **Роль**: Основной маркетплейс для тестирования спроса и генерации оборота

#### Shopify
- **Роль**: Базовый витринный слой системы (D2C‑канал)
- **Функции**: 
  - Тестирование гипотез по воронкам продаж
  - Дублирование маржинальных позиций
  - Построение независимого брендового канала

#### Meta Business Suite
- **Роль**: Рекламно‑коммуникационный контур
- **Функции**: 
  - Перформанс‑маркетинг
  - Ретаргетинг
  - Тестирование креативов
  - Прогрев аудитории

### 2. Оркестрация (n8n)

**Роль**: Центральный оркестратор бизнес‑процессов

**Функции**:
- Интеграция внешних API
- Cron‑сценарии
- Обработка вебхуков
- Нотификации
- Агрегация данных

**Архитектурная позиция**: "Шлюз автоматизации" между внешними сервисами и внутренней логикой

### 3. Хранилище данных (Supabase)

**Роль**: Централизованный персистентный слой данных

**Функции**:
- Хранение транзакционных данных
- REST/RPC API для доступа к данным
- Управление схемой данных
- Безопасность и масштабируемость

**Архитектурная позиция**: "Объективная операционная память системы"

### 4. AI‑слой

#### OpenAI API
- **Роль**: Базовый AI‑движок
- **Функции**: 
  - Аналитика спроса
  - Генерация описаний
  - Технические скрипты
  - Вспомогательные сервисы

#### AI‑агенты
- **Planner-Agent**: Декомпозиция задач
- **Account-Agent**: Проверка инфраструктуры
- **Multi-Sourcing-Agent**: Поиск у нескольких поставщиков
- **Compliance-Agent**: Валидация листингов
- **Listing-Agent**: Создание листингов
- **Pricing-Agent**: Умное ценообразование
- **Ops-Agent**: Автовыполнение заказов
- **Reputation-Agent**: Мониторинг репутации
- **Analytics-Agent**: Отчёты и аналитика

### 5. Автоматизация закупок (AutoDS)

**Роль**: Управляющий слой для автоматизации закупок

**Функции**:
- Автоматическое размещение заказов
- Мониторинг цен поставщиков
- Синхронизация остатков между площадками

### 6. Уведомления (Telegram Bot)

**Роль**: Канал оперативных уведомлений

**Функции**:
- Уведомления об ошибках
- Критические изменения цен
- Срабатывание лимитов
- Сбои авто‑заказов
- Падение доступности сервисов

### 7. База знаний (Notion)

**Роль**: Долговременная когнитивная память проекта

**Функции**:
- Хранение знаний, решений, практик
- Шаблоны и процедуры
- Журнал ошибок и уроков
- Техническая документация

## Потоки данных

### Поток создания листинга

1. **Products Research** (Notion) → Идея товара
2. **Multi-Sourcing-Agent** → Поиск поставщиков
3. **Pricing-Agent** → Расчёт цены
4. **Compliance-Agent** → Валидация
5. **Listing-Agent** → Создание листинга
6. **n8n** → Публикация на платформе
7. **Supabase** → Сохранение данных

### Поток обработки заказа

1. **Платформа** (eBay/Shopify) → Новый заказ
2. **n8n** → Получение заказа через webhook
3. **Supabase** → Сохранение заказа
4. **AutoDS** → Автоматическое размещение заказа у поставщика
5. **Telegram** → Уведомление о заказе
6. **Supabase** → Обновление статуса
7. **Платформа** → Обновление статуса заказа

### Поток мониторинга

1. **Различные компоненты** → События
2. **n8n** → Обработка событий
3. **Supabase** → Логирование
4. **Telegram** → Уведомления (при необходимости)
5. **Analytics-Agent** → Анализ и отчёты

## Безопасность

### Управление секретами

- **Хранилище**: 1Password / Bitwarden / Notion (закрытая страница)
- **Принцип**: Единый источник правды для всех ключей и токенов
- **Ротация**: Планово каждые 90 дней для критичных сервисов

### Контроль доступа

- **Supabase**: Row Level Security (RLS) для всех таблиц
- **API**: Аутентификация через OAuth и токены
- **База знаний**: Ограниченный доступ только необходимым людям

## Масштабирование

### Фазы развития

1. **Фаза 0**: Ручная настройка инфраструктуры
2. **Фаза 1**: Базовые автоматизированные процессы
3. **Фаза 2**: Расширенная автоматизация с AI‑агентами
4. **Фаза 3**: Полностью автономная система

### Точки расширения

- Добавление новых платформ продаж
- Интеграция новых поставщиков
- Расширение функциональности AI‑агентов
- Добавление новых каналов уведомлений

## Мониторинг и поддержка

### Логирование

- **Supabase**: Таблица errors для всех ошибок
- **n8n**: Логи выполнения воркфлоу
- **Notion**: База Errors & Incidents для анализа

### Уведомления

- **Telegram Bot**: Критические события
- **Email**: Ежедневные/еженедельные отчёты (опционально)

## См. также

- [SETUP_*.md](SETUP_SHOPIFY.md) — Документация по настройке платформ
- [KB_MAIN.md](KB_MAIN.md) — Главная страница базы знаний
- [SECRETS_MANAGEMENT.md](SECRETS_MANAGEMENT.md) — Управление секретами

