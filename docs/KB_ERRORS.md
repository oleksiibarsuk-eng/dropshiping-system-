# База Errors & Incidents

## Назначение

Журнал ошибок и инцидентов для анализа и предотвращения повторений. Фиксация всех значимых ошибок, сбоев и инцидентов позволяет выявлять паттерны, улучшать систему и создавать превентивные меры.

## Структура базы данных

### Основные поля

#### Title
- **Тип**: Текст
- **Описание**: Краткое название инцидента
- **Пример**: "AutoDS failed to place order", "eBay listing rejected"

#### Severity
- **Тип**: Select
- **Описание**: Серьёзность инцидента
- **Варианты**: 
  - critical — критический (система не работает)
  - high — высокий (критическая функция не работает)
  - medium — средний (частичная деградация)
  - low — низкий (незначительное влияние)
- **Пример**: "high"

#### Component
- **Тип**: Select
- **Описание**: Компонент системы, где произошла ошибка
- **Варианты**: 
  - AutoDS
  - eBay
  - Shopify
  - Meta
  - n8n
  - Supabase
  - OpenAI
  - Telegram
  - Other
- **Пример**: "AutoDS"

#### Error Type
- **Тип**: Select
- **Описание**: Тип ошибки
- **Варианты**: 
  - API Error — ошибка API
  - Authentication — проблема с аутентификацией
  - Data — проблема с данными
  - Network — сетевая проблема
  - Configuration — проблема конфигурации
  - Logic — логическая ошибка
  - Other — другое
- **Пример**: "API Error"

#### Description
- **Тип**: Текст (длинный)
- **Описание**: Подробное описание инцидента
- **Что фиксировать**:
  - Что произошло
  - Когда произошло
  - Какие действия были выполнены
  - Какие данные были задействованы
- **Пример**: "AutoDS не смог разместить заказ для товара Sony A7III. Заказ был создан в системе, но AutoDS вернул ошибку 'Supplier out of stock'. Проверка показала, что товар действительно закончился у поставщика."

#### Error Message
- **Тип**: Текст
- **Описание**: Точное сообщение об ошибке (если есть)
- **Пример**: "Error 404: Supplier not found"

#### Stack Trace / Logs
- **Тип**: Текст (очень длинный) или Code block
- **Описание**: Stack trace, логи, или другие технические детали
- **Пример**: [Code block с логами]

#### Impact
- **Тип**: Текст (длинный)
- **Описание**: Влияние на бизнес
- **Что фиксировать**:
  - Сколько заказов затронуто
  - Сколько времени система была недоступна
  - Финансовые потери (если применимо)
- **Пример**: "1 заказ не был размещён, клиент получил уведомление об отмене. Потеря потенциальной прибыли: €150."

#### Root Cause
- **Тип**: Текст (длинный)
- **Описание**: Корневая причина инцидента
- **Пример**: "Отсутствие проверки наличия товара у поставщика перед созданием заказа в системе."

#### Resolution
- **Тип**: Текст (длинный)
- **Описание**: Как была решена проблема
- **Пример**: "Добавлена проверка наличия товара через AutoDS API перед созданием заказа. Если товара нет, система автоматически ищет альтернативного поставщика через Multi-Sourcing-Agent."

#### Prevention
- **Тип**: Текст (длинный)
- **Описание**: Меры для предотвращения повторения
- **Пример**: 
  - "Добавлена проверка наличия товара перед созданием заказа"
  - "Создан SOP для обработки таких случаев"
  - "Добавлено уведомление в Telegram при отсутствии товара"

#### Status
- **Тип**: Select
- **Описание**: Статус инцидента
- **Варианты**: 
  - open — открыт
  - investigating — расследуется
  - resolved — решён
  - closed — закрыт
- **Пример**: "resolved"

#### Date occurred
- **Тип**: Date + Time
- **Описание**: Когда произошёл инцидент
- **Пример**: 2024-01-20 14:30

#### Date resolved
- **Тип**: Date + Time
- **Описание**: Когда был решён инцидент
- **Пример**: 2024-01-20 15:45

#### Related Items
- **Тип**: Links
- **Описание**: Связанные элементы
- **Может включать**:
  - Связанные заказы
  - Связанные товары
  - Связанные SOP
  - Связанные задачи
- **Пример**: 
  - Order: [Order #12345]
  - SOP: [SOP: Order Processing]

## Примеры записей

### Пример 1: API ошибка

```
Title: AutoDS failed to place order
Severity: high
Component: AutoDS
Error Type: API Error
Description: AutoDS не смог разместить заказ для товара Sony A7III. Заказ был создан в системе, но AutoDS вернул ошибку при попытке размещения заказа у поставщика.

Error Message: "Error 500: Internal server error"
Stack Trace: [логи из n8n]
Impact: 1 заказ не был размещён, клиент получил уведомление об отмене. Потеря потенциальной прибыли: €150.
Root Cause: Временный сбой на стороне AutoDS API, возможно из-за высокой нагрузки.
Resolution: Повторная попытка через 5 минут успешно разместила заказ. Добавлен retry механизм в n8n workflow.
Prevention: 
  - Добавлен retry с exponential backoff в n8n workflow
  - Добавлено уведомление в Telegram при ошибках AutoDS
  - Создан мониторинг доступности AutoDS API
Status: resolved
Date occurred: 2024-01-20 14:30
Date resolved: 2024-01-20 15:45
Related Items:
  - Order: [Order #12345]
  - n8n workflow: [order-fulfillment.json]
```

### Пример 2: Проблема с данными

```
Title: eBay listing rejected due to compliance violation
Severity: medium
Component: eBay
Error Type: Data
Description: Листинг для товара Canon EF 50mm был отклонён eBay из-за нарушения политики. В описании было использовано запрещённое слово "replica" (хотя товар оригинальный).

Error Message: "Listing rejected: Prohibited word 'replica' in description"
Impact: Листинг не был опубликован, потеря потенциальных продаж на 1 день.
Root Cause: Compliance-Agent не проверил описание на наличие запрещённых слов перед публикацией.
Resolution: Удалено слово "replica" из описания, листинг успешно опубликован. Обновлён Compliance-Agent для проверки запрещённых слов.
Prevention:
  - Обновлён Compliance-Agent с полным списком запрещённых слов
  - Добавлена проверка перед публикацией
  - Создан SOP для проверки описаний
Status: resolved
Date occurred: 2024-01-18 10:15
Date resolved: 2024-01-18 10:30
Related Items:
  - Listing: [Listing #67890]
  - Compliance-Agent: [compliance-agent.md]
  - SOP: [SOP: Listing Creation]
```

## Рекомендации по использованию

1. **Немедленная фиксация**: Фиксируйте инциденты сразу после их обнаружения
2. **Детальность**: Чем больше деталей, тем лучше для анализа
3. **Анализ паттернов**: Периодически анализируйте базу для выявления паттернов
4. **Связность**: Связывайте инциденты с SOP и улучшениями системы

## Интеграция с системой

База Errors & Incidents интегрируется с:
- **Supabase** — таблица errors синхронизируется с этой базой
- **Telegram Bot** — автоматические уведомления о критических инцидентах
- **n8n workflows** — автоматическое логирование ошибок
- **SOPs** — создание новых SOP на основе инцидентов

## Анализ и улучшения

Используйте базу для:
- **Выявления паттернов**: Какие ошибки повторяются чаще всего
- **Приоритизации**: На какие проблемы обратить внимание в первую очередь
- **Улучшения системы**: Какие изменения нужно внести для предотвращения ошибок
- **Обучения**: Примеры для обучения команды

## См. также

- [KB_MAIN.md](KB_MAIN.md) — главная страница базы знаний
- [KB_SOPS.md](KB_SOPS.md) — база SOPs для обработки инцидентов
- [Шаблон для Notion](../../templates/notion/errors-template.md)

