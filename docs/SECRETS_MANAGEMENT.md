# Управление секретами и учетными данными

## Обзор

Централизованное и дисциплинированное хранение учётных данных критично для безопасности, воспроизводимости и возможности делегирования задач. Ошибки на этом уровне приводят либо к утечкам (и, как следствие, блокировкам, финансовым потерям), либо к хаосу, когда никто не знает, где какие ключи используются и как их ротация влияет на систему.

## ⚠️ Критически важно

**НИКОГДА не храните секреты в:**
- Открытых документах
- Чатах (Telegram, Slack без шифрования)
- Скриншотах
- Публичных репозиториях
- Коммитах в Git (даже в закрытых репозиториях)

## Рекомендуемые инструменты

Используйте специализированные решения:

1. **1Password** — платный, но очень удобный
2. **Bitwarden** — бесплатный вариант с открытым исходным кодом
3. **Notion** — строго закрытая страница с ограниченным доступом (не рекомендуется для критичных данных)
4. **HashiCorp Vault** — для продвинутых пользователей

## Структура хранилища секретов

### Shopify

- **Store URL** — URL вашего магазина
- **Admin API Key** — ключ для API доступа
- **Admin Access Token** — токен для аутентификации
- **Store ID** — ID магазина (при необходимости)
- **Подключённые домены** — список доменов
- **Список основных приложений** — установленные приложения

### eBay

**eBay.com:**
- **Логин** — логин аккаунта
- **Dev ID** — Developer ID
- **App ID** — Application ID (Client ID)
- **Cert ID** — Certificate ID (Client Secret)
- **User OAuth Token** — токен для доступа к аккаунту
- **Redirect URI** — URI для OAuth редиректа
- **Список использованных API‑сетов** — какие API используются

**eBay.de:**
- **Логин** — логин аккаунта
- **Dev ID** — Developer ID
- **App ID** — Application ID
- **Cert ID** — Certificate ID
- **User OAuth Token** — токен для доступа к аккаунту
- **Redirect URI** — URI для OAuth редиректа

### Meta (Facebook/Instagram)

- **Business ID** — ID бизнес-менеджера
- **Ad Account ID** — ID рекламного аккаунта
- **System User Access Token** — токен системного пользователя
- **ID основных страниц** — Facebook Page ID и Instagram Account ID
- **ID каталогов** — если используются каталоги товаров

### AutoDS

- **Логин** — логин аккаунта
- **API Key** — ключ для API доступа
- **Краткое описание подключённых маркетплейсов** — какие каналы подключены

### n8n

**Cloud версия:**
- **Instance URL** — URL вашего инстанса
- **Логин/пароль** — если используется basic‑auth

**Self-hosted версия:**
- **Instance URL** — URL вашего инстанса
- **Логин/пароль** — если используется встроенная авторизация
- **Данные доступа к серверу** — SSH ключи, IP адрес (если применимо)

### OpenAI

- **API Key** — ключ API (начинается с `sk-`)
- **Лимит бюджета** — установленный месячный лимит
- **Внутренние правила использования** — какие промпты и сценарии используются
- **Список основных промптов и сценариев** — для отслеживания использования

### Telegram

- **Bot Token** — токен бота от BotFather
- **Chat ID** — ID чата для личных сообщений
- **Group Chat IDs** — если используются групповые чаты, список этих чатов и их назначение

### Supabase

- **Project URL** — URL вашего проекта
- **anon key** — публичный ключ
- **service_role key** — приватный ключ (храните в секрете!)
- **Database password** — пароль для прямого доступа к БД
- **Ссылка на документацию по текущей схеме** — где хранится актуальная схема БД

## Дополнительные поля для каждого сервиса

Рекомендуется добавить следующие поля для каждого сервиса:

- **Статус подключения** — подключено / тестируется / в проде
- **Дата последней проверки** — когда последний раз проверяли работоспособность
- **Дата последней ротации ключей** — когда последний раз меняли ключи
- **Ответственный** — кто отвечает за этот сервис
- **Примечания** — любые дополнительные заметки

## Ротация ключей

### Когда ротировать ключи:

1. **Планово** — каждые 90 дней для критичных сервисов
2. **При подозрении на утечку** — немедленно
3. **При увольнении сотрудника** — если у него был доступ
4. **При изменении политики безопасности** — по требованию

### Процесс ротации:

1. Создайте новый ключ в сервисе
2. Обновите ключ во всех местах использования (n8n, скрипты, конфиги)
3. Протестируйте работоспособность
4. Удалите старый ключ
5. Обновите дату ротации в хранилище секретов

## Аудит хранилища секретов

Периодически (рекомендуется раз в месяц) проводите аудит:

1. **Проверьте неиспользуемые ключи** — удалите или отметьте как неактивные
2. **Проверьте устаревшие ключи** — обновите или удалите
3. **Проверьте доступ** — кто имеет доступ к хранилищу секретов
4. **Проверьте логи доступа** — если ваш инструмент поддерживает логирование

## Интеграция с системой

Хранилище секретов должно быть единственным источником правды для всех ключей и токенов. Все остальные места (конфиги, переменные окружения) должны ссылаться на хранилище или синхронизироваться с ним.

## Шаблон для Notion/1Password/Bitwarden

Используйте следующий шаблон для каждого сервиса:

```
=== [Название сервиса] ===

Логин: [логин]
Пароль: [пароль] (если применимо)

API Key / Token: [ключ]
Дополнительные ключи:
  - Key 1: [значение]
  - Key 2: [значение]

URLs:
  - Dashboard: [ссылка]
  - API Docs: [ссылка]

Статус: [подключено/тестируется/в проде]
Дата последней проверки: [дата]
Дата последней ротации: [дата]
Ответственный: [имя]

Примечания:
[любые дополнительные заметки]
```

## См. также

- [config/credentials.template.json](../config/credentials.template.json) — шаблон для локального хранения (только для разработки)
- [config/secrets-structure.md](../config/secrets-structure.md) — детальная структура хранилища

