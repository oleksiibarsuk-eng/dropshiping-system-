# Настройка n8n

## Обзор

n8n выполняет роль центрального оркестратора бизнес‑процессов: интеграция внешних API, cron‑сценарии, обработка вебхуков, нотификации, агрегация данных. Он позволяет строить достаточно сложные цепочки событий без необходимости разворачивать полноценный парк микросервисов, при этом сохраняя возможность постепенно выносить критичные части в отдельные сервисы.

С точки зрения архитектуры система предполагает, что n8n будет «шлюзом автоматизации» между внешними сервисами (eBay, Shopify, AutoDS, OpenAI, Telegram, Supabase) и внутренней логикой. Это означает, что именно здесь будут находиться основные точки входа для событий (webhook, cron) и точки выхода (запись в БД, отправка уведомлений, вызов AI).

## ⚠️ Важные замечания

На практике именно n8n становится тем местом, где обнаруживаются узкие места процессов:
- Зависания
- Ошибки авторизации
- Некорректные payload'ы

Поэтому важно с самого начала закладывать хорошие практики:
- Логирование
- Алертинг
- Версионирование воркфлоу (экспорт JSON в репозиторий)

## ⏱️ Оценка трудоёмкости

- **Cloud**: ~10–20 минут
- **Self‑hosted**: ~30–60 минут при базовых навыках работы с Docker и сетевой конфигурацией, плюс дополнительное время на отладку первых воркфлоу

## Варианты развёртывания

### Вариант A: n8n Cloud (проще, но платно)

1. Зарегистрируйтесь на [n8n.io](https://www.n8n.io)
2. Выберите подходящий план:
   - **Starter** ($20/месяц) — включает 5,000 выполнений workflows, что достаточно для начала
3. Сохраните URL вашего cloud instance, который будет выглядеть как `https://ваш-инстанс.app.n8n.cloud`
4. Этот URL потребуется для настройки webhooks

**Преимущества:**
- Проще в настройке
- Не требует технических знаний
- Автоматические обновления
- Встроенный мониторинг

**Недостатки:**
- Платно ($20+/месяц)
- Ограничения на количество выполнений

### Вариант B: Self-hosted (дешевле, но требует DevOps‑минимума)

#### 1. Аренда VPS сервера

Арендуйте VPS сервер на одном из популярных провайдеров:
- **DigitalOcean** — от $5/месяц
- **Hetzner** — от €4/месяц
- **Vultr** — от $5/месяц

Базовый план должен включать:
- Минимум 1 GB RAM
- Минимум 1 CPU
- Минимум 10 GB дискового пространства

#### 2. Установка n8n через Docker

Подключитесь к серверу через SSH и выполните команду:

```bash
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
```

Данный запуск создаёт персистентный том для конфигурации и логов и позволяет быстро обновлять контейнер без потери настроек.

#### 3. Опционально: Настройка доменного имени

1. Настройте доменное имя, например `n8n.yourdomain.com`
2. Настройте HTTPS сертификат через Let's Encrypt для безопасного соединения
3. Используйте nginx или другой reverse proxy для проксирования запросов

#### 4. Настройка Webhook URL

1. Включите **Webhook URL** в настройках n8n для приема внешних событий от Shopify и других сервисов
2. Для self-hosted версии это будет ваш домен или IP адрес

**Преимущества:**
- Дешевле в долгосрочной перспективе ($5-10/месяц)
- Полный контроль над инфраструктурой
- Нет ограничений на выполнение

**Недостатки:**
- Требует базовых технических навыков
- Необходимо самостоятельно обновлять и поддерживать

## Сохранение данных для интеграции

Сохраните следующие данные в хранилище секретов (см. [SECRETS_MANAGEMENT.md](SECRETS_MANAGEMENT.md)):

- **Instance URL** — URL вашего развёрнутого n8n
- **Логин/пароль** — если используется basic‑auth или встроенная авторизация
- **При self-hosted** — данные доступа к серверу (SSH ключи, IP адрес)

## Версионирование воркфлоу

Рекомендуется экспортировать все воркфлоу в JSON и хранить их в репозитории в папке `n8n-workflows/`. Это позволяет:
- Отслеживать изменения
- Восстанавливать воркфлоу при сбоях
- Делиться воркфлоу между командами

## Следующие шаги

После настройки n8n переходите к:
- [SETUP_OPENAI.md](SETUP_OPENAI.md) — Настройка OpenAI API
- [SETUP_TELEGRAM.md](SETUP_TELEGRAM.md) — Настройка Telegram Bot
- [SETUP_SUPABASE.md](SETUP_SUPABASE.md) — Настройка Supabase

