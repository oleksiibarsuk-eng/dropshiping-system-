# Настройка Telegram Bot

## Обзор

Телеграм‑бот выполняет роль лёгкого, но чрезвычайно эффективного канала оперативных уведомлений: ошибки, критические изменения цен, срабатывание лимитов eBay, сбои авто‑заказов, падение доступности сервисов. В отличие от e‑mail, такие уведомления практически не теряются и быстро обрабатываются, особенно если вы интегрируете бота в уже существующую рабочую группу.

При грамотной конфигурации Telegram‑контур становится нервной системой проекта: любое значимое событие (заказ, инцидент, сбой) оставляет след в виде сообщения, на который можно быстро отреагировать или прикрепить к тикету поддержки.

## ⏱️ Оценка трудоёмкости

~5–10 минут, после чего налаживается постоянный канал связи системы с оператором или командой.

## Шаги настройки

### 1. Создание бота через BotFather

1. Откройте Telegram мессенджер
2. Найдите официального бота **BotFather** через поиск или перейдя по ссылке [t.me/BotFather](https://t.me/BotFather)
3. Отправьте команду `/newbot` для начала создания нового бота
4. Следуйте инструкциям BotFather:
   - Введите имя бота (например, "Dropshipping Alerts")
   - Введите username бота (должен заканчиваться на `bot`, например `dropshipping_alerts_bot`)
5. Сохраните полученный **Bot Token** (начинается с `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. Получение Chat ID

#### Для личных сообщений:

1. Начните диалог с вашим ботом в Telegram
2. Отправьте любое сообщение боту
3. Откройте в браузере: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. Найдите в ответе поле `"chat":{"id":123456789}` — это ваш Chat ID

#### Для групповых чатов:

1. Добавьте бота в группу
2. Сделайте бота администратором группы (опционально, но рекомендуется)
3. Отправьте сообщение в группу
4. Откройте в браузере: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
5. Найдите в ответе поле `"chat":{"id":-123456789}` (отрицательное число для групп) — это Chat ID группы

### 3. Тестирование отправки сообщений

Протестируйте отправку сообщений через API:

```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/sendMessage" \
  -d "chat_id=<YOUR_CHAT_ID>&text=Test message"
```

Если сообщение успешно приходит, значит базовая связка n8n → Telegram API тоже будет работать при корректной конфигурации.

### 4. Определение структуры уведомлений

На этом этапе можно уже задуматься о структуре будущих уведомлений:

- **Формат** — какие данные включать в сообщения
- **Критичность** — уровни важности (info, warning, error, critical)
- **Теги** — для категоризации уведомлений (например, `[eBay]`, `[Shopify]`, `[AutoDS]`)

Пример структуры сообщения:

```
[CRITICAL] [eBay] Listing limit reached
Account: eBay US
Current listings: 50/50
Action required: Upgrade account or remove old listings
```

## Сохранение данных для интеграции

Сохраните следующие данные в хранилище секретов (см. [SECRETS_MANAGEMENT.md](SECRETS_MANAGEMENT.md)):

- **Bot Token** — полученный от BotFather
- **Chat ID** — для личных сообщений
- **Group Chat IDs** — если используются групповые чаты, список этих чатов и их назначение

## Интеграция с системой

Telegram Bot интегрируется в систему через:
- **n8n workflows** — для отправки уведомлений о событиях
- **Supabase** — для логирования отправленных уведомлений
- **Различные агенты** — для отправки алертов о критических событиях

## Типы уведомлений

Рекомендуется настроить следующие типы уведомлений:

1. **Ошибки** — критические ошибки в системе
2. **Лимиты** — достижение лимитов на платформах
3. **Заказы** — новые заказы и их статусы
4. **Цены** — критические изменения цен
5. **Доступность** — падение доступности сервисов
6. **Ежедневные отчёты** — сводка за день

## Следующие шаги

После настройки Telegram Bot переходите к:
- [SETUP_SUPABASE.md](SETUP_SUPABASE.md) — Настройка Supabase
- Настройке n8n workflows для отправки уведомлений

